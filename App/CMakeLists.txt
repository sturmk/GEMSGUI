
if (WIN32)
#! [appicon_windows]
    set(app_icon_resource_windows "${CMAKE_CURRENT_SOURCE_DIR}/gem-selektor.rc")
    qt_add_executable(gem-selektor main.cpp ${app_icon_resource_windows})
#! [appicon_windows]
elseif (APPLE)
#! [appicon_macOS]
    # The MACOSX_BUNDLE_ICON_FILE variable is added to the Info.plist
    # generated by CMake. This variable contains the .icns file name,
    # without the path.
    set(MACOSX_BUNDLE_ICON_FILE gems3.icns)

    # And the following tells CMake where to find and install the file itself.
    set(app_icon_macos "${CMAKE_CURRENT_SOURCE_DIR}/Resources/gems3.icns")
    set_source_files_properties(${app_icon_macos} PROPERTIES
           MACOSX_PACKAGE_LOCATION "Resources")

    qt_add_executable(gem-selektor MACOSX_BUNDLE main.cpp ${app_icon_macos})

    set_target_properties(gem-selektor PROPERTIES
        # WIN32_EXECUTABLE TRUE
        MACOSX_BUNDLE_GUI_IDENTIFIER ch.psi.gems3
        MACOSX_BUNDLE_COPYRIGHT  "Copyright (c) 2004-2025 GEMS Development Team"
        MACOSX_BUNDLE_ICON_FILE gems3.icns
        MACOSX_BUNDLE_INFO_STRING "GEM-Selektor package for geochemical modeling"
        MACOSX_BUNDLE_BUNDLE_VERSION ${PROJECT_VERSION}
        MACOSX_BUNDLE_SHORT_VERSION_STRING ${PROJECT_VERSION_MAJOR}.${PROJECT_VERSION_MINOR}
        MACOSX_BUNDLE TRUE
    )

#! [appicon_macOS]
else()
    qt_add_executable(gem-selektor main.cpp)
    install(FILES ${CMAKE_CURRENT_SOURCE_DIR}/gem-selektor.desktop DESTINATION share/applications)
    install(FILES ${PROJECT_SOURCE_DIR}/Resources/gem-selektor.png DESTINATION share/icons)
endif()


if(${CMAKE_CXX_COMPILER_ID} STREQUAL MSVC)
  target_link_libraries (gem-selektor PRIVATE GEMSGUI-static GEMS3K::GEMS3K-static)
else()
  target_link_libraries (gem-selektor PRIVATE GEMSGUI-static )
endif()

install(TARGETS gem-selektor
    BUNDLE  DESTINATION .
    RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
    LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
)


if(DEFINED ENV{CONDA_PREFIX})

message(STATUS "conda path: $ENV{CONDA_PREFIX}")

if(${CMAKE_CXX_COMPILER_ID} MATCHES "Clang")

   #set_source_files_properties(${SHADERS}
   #     PROPERTIES
   #     MACOSX_PACKAGE_LOCATION "Resources"
   # )

else()

   install(FILES ${PROJECT_SOURCE_DIR}/Resources/gem-selektor.ico
        DESTINATION ${CMAKE_INSTALL_BINDIR} )

endif()

if(${CMAKE_CXX_COMPILER_ID} STREQUAL MSVC)

    set(dll_path "C:/Miniconda/envs/GEMSGUI/Library/bin")
    message(STATUS "dll path: ${dll_path}")
    install(FILES "${dll_path}/GEMS3K.dll" DESTINATION bin)
    install(FILES "${dll_path}/ChemicalFun.dll" DESTINATION bin)
    install(FILES "${dll_path}/ThermoFun.dll" DESTINATION bin)
    install(FILES "${dll_path}/fmt.dll" DESTINATION bin)
    install(FILES "${dll_path}/libzmq-mt-4_3_5.dll" DESTINATION bin)
    install(FILES "${dll_path}/zlib.dll" DESTINATION bin)

    install(FILES "${dll_path}/gssapi64.dll" DESTINATION bin)
    install(FILES "${dll_path}/libsodium.dll" DESTINATION bin)
    install(FILES "${dll_path}/spdlog.dll" DESTINATION bin)
    install(FILES "${dll_path}/libpng16.dll" DESTINATION bin)

    install(FILES "${dll_path}/double-conversion.dll" DESTINATION bin)
    install(FILES "${dll_path}/pcre2-16.dll" DESTINATION bin)
    install(FILES "${dll_path}/freetype.dll" DESTINATION bin)
    install(FILES "${dll_path}/zstd.dll" DESTINATION bin)

    install(FILES "${dll_path}/krb5_64.dll" DESTINATION bin)
    install(FILES "${dll_path}/comerr64.dll" DESTINATION bin)
    install(FILES "${dll_path}/k5sprt64.dll" DESTINATION bin)

    install(FILES "${dll_path}/vcruntime140.dll" DESTINATION bin)
    install(FILES "${dll_path}/msvcp140.dll" DESTINATION bin)
    install(FILES "${dll_path}/opengl32sw.dll" DESTINATION bin)
    install(FILES "${dll_path}/sqlite3.dll" DESTINATION bin)
endif()

endif()

qt_generate_deploy_app_script(
    TARGET gem-selektor
    OUTPUT_SCRIPT deploy_script
    MACOS_BUNDLE_POST_BUILD
    NO_TRANSLATIONS
    NO_UNSUPPORTED_PLATFORM_ERROR
)
install(SCRIPT ${deploy_script})
